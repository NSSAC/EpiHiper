{
  "epiHiperSchema":"https://github.com/NSSAC/EpiHiper-Schema/blob/master/schema/interventionSchema.json",
  "sets":[
    {
      "id":"triggerTemplate1_enteredIsymp",
      "ann:label":"Nodes which entered state Isymp.",
      "scope":"local",
      "content":{
        "operation":"intersection",
        "sets":[
          {
            "elementType":"node",
            "scope":"local",
            "left":{
              "node":{
                "property":"healthState"
              }
            },
            "operator":"withPropertyIn",
            "right":{
              "valueList":{
                "healthState":[
                  "Ipresymp_p",
                  "Ipresymp_s",
                  "Ipresymp_a",
                  "Ipresymp_o",
                  "Ipresymp_g"
                ]
              }
            }
          },
          {
            "elementType":"node",
            "scope":"local",
            "left":{
              "node":{
                "property":"nodeTrait",
                "feature":"enteredIsymp"
              }
            },
            "operator":"==",
            "right":{
              "value":{
                "trait":"nodeTrait",
                "feature":"enteredIsymp",
                "enum":"false"
              }
            }
          }
        ]
      }
    },
    {
      "id":"participateInStayHomeGlobal",
      "ann:label":"all nodes participating in stay home",
      "scope":"global",
      "content":{
        "elementType":"node",
        "scope":"global",
        "left":{
          "node":{
            "property":"nodeTrait",
            "feature":"participateInStayHome"
          }
        },
        "operator":"==",
        "right":{
          "value":{
            "trait":"nodeTrait",
            "feature":"participateInStayHome",
            "enum":"true"
          }
        }
      }
    },
    {
      "id":"participateInHomeIsolationGlobal",
      "ann:label":"All nodes which participate in voluntary home isolation.",
      "scope":"global",
      "content":{
        "elementType":"node",
        "scope":"global",
        "left":{
          "node":{
            "property":"nodeTrait",
            "feature":"participateInHomeIsolation"
          }
        },
        "operator":"==",
        "right":{
          "value":{
            "trait":"nodeTrait",
            "feature":"participateInHomeIsolation",
            "enum":"true"
          }
        }
      }
    },
    {
      "id":"nonHomeEdgesTarget",
      "scope":"local",
      "content":{
        "elementType":"edge",
        "left":{
          "edge":{
            "property":"targetActivity",
            "feature":"activityType"
          }
        },
        "operator":"!=",
        "right":{
          "value":{
            "trait":"activityTrait",
            "feature":"activityType",
            "enum":"home"
          }
        }
      }
    },
    {
      "id":"targetNodeParticipateInStayHome",
      "scope":"local",
      "content":{
        "operation":"intersection",
        "sets":[
          {
            "scope":"local",
            "elementType":"edge",
            "operator":"withTargetNodeIn",
            "selector":{
              "set":{
                "idRef":"participateInStayHomeGlobal"
              }
            }
          },
          {
            "set":{
              "idRef":"nonHomeEdgesTarget"
            }
          }
        ]
      }
    },
    {
      "id":"sourceNodeParticipateInStayHome",
      "scope":"local",
      "content":{
        "operation":"intersection",
        "sets":[
          {
            "elementType":"edge",
            "operator":"withSourceNodeIn",
            "selector":{
              "set":{
                "idRef":"participateInStayHomeGlobal"
              }
            }
          },
          {
            "set":{
              "idRef":"nonHomeEdgesTarget"
            }
          }
        ]
      }
    },
    {
      "id":"targetNodeParticipateInHomeIsolation",
      "scope":"local",
      "content":{
        "operation":"intersection",
        "sets":[
          {
            "scope":"local",
            "elementType":"edge",
            "operator":"withTargetNodeIn",
            "selector":{
              "set":{
                "idRef":"participateInHomeIsolationGlobal"
              }
            }
          },
          {
            "set":{
              "idRef":"nonHomeEdgesTarget"
            }
          }
        ]
      }
    },
    {
      "id":"sourceNodeParticipateInHomeIsolation",
      "scope":"local",
      "content":{
        "operation":"intersection",
        "sets":[
          {
            "elementType":"edge",
            "operator":"withSourceNodeIn",
            "selector":{
              "set":{
                "idRef":"participateInHomeIsolationGlobal"
              }
            }
          },
          {
            "set":{
              "idRef":"nonHomeEdgesTarget"
            }
          }
        ]
      }
    },
    {
      "id": "availableForVaccination",
      "ann:label": "Nodes available for vaccination.",
      "scope": "local",
      "content": {
        "operation": "intersection",
        "sets": [
          {
            "elementType": "node",
            "scope": "local",
            "left": {
              "node": {"property": "healthState"}
            },
            "operator": "withPropertyIn",
            "right": {
              "valueList": {
                "healthState": [
                  "S_p",
                  "S_s",
                  "S_a",
                  "S_o",
                  "S_g",
                  "E_p",
                  "E_s",
                  "E_a",
                  "E_o",
                  "E_g",
                  "Ipresymp_p",
                  "Ipresymp_s",
                  "Ipresymp_a",
                  "Ipresymp_o",
                  "Ipresymp_g",
                  "Iasymp_p",
                  "Iasymp_s",
                  "Iasymp_a",
                  "Iasymp_o",
                  "Iasymp_g"
                ]
              }
            }
          },
          {
            "elementType": "node",
            "scope": "local",
            "left": {
              "node": {
                "property": "nodeTrait",
                "feature": "vaccinated"
              }
            },
            "operator": "==",
            "right": {
              "value": {
                "trait": "nodeTrait",
                "feature": "vaccinated",
                "enum": "false"
              }
            }
          }
        ]
      }
    }
  ],
  "variables":[
    {
      "id":"stayHome",
      "ann:label":"whether stay home order has been issued",
      "scope":"global",
      "initialValue":0
    },
    {
      "id":"schoolClosed",
      "ann:label":"whether schools have been closed",
      "scope":"global",
      "initialValue":0
    }
  ],
  "triggers":[
    {
      "trigger":{
        "left":{
          "observable":"time"
        },
        "operator":"==",
        "right":{
          "value":{
            "number":33
          }
        }
      },
      "interventionIds":[
        "intervention_SH_select"
      ]
    },
    {
      "trigger":{
        "left":{
          "observable":"time"
        },
        "operator":"==",
        "right":{
          "value":{
            "number":15
          }
        }
      },
      "interventionIds":[
        "intervention_SC1",
        "intervention_SC2"
      ]
    },
    {
      "trigger":{
        "left":{
          "sizeof":{
            "set":{
              "idRef":"triggerTemplate1_enteredIsymp"
            }
          }
        },
        "operator":">",
        "right":{
          "value":{
            "number":0
          }
        }
      },
      "interventionIds":[
        "intervention_VHI_select"
      ]
    },
    {
      "ann:id":"stayHomeSelf",
      "trigger":{
        "left":{
          "sizeof":{
            "set":{
              "idRef":"targetNodeParticipateInStayHome"
            }
          }
        },
        "operator":">",
        "right":{
          "value":{
            "number":0
          }
        }
      },
      "interventionIds":[
        "intervention_SH1"
      ]
    },
    {
      "ann:id":"stayHomeContacts",
      "trigger":{
        "left":{
          "sizeof":{
            "set":{
              "idRef":"sourceNodeParticipateInStayHome"
            }
          }
        },
        "operator":">",
        "right":{
          "value":{
            "number":0
          }
        }
      },
      "interventionIds":[
        "intervention_SH2"
      ]
    },
    {
      "ann:id":"voluntaryHomeIsolationSelf",
      "trigger":{
        "left":{
          "sizeof":{
            "set":{
              "idRef":"targetNodeParticipateInHomeIsolation"
            }
          }
        },
        "operator":">",
        "right":{
          "value":{
            "number":0
          }
        }
      },
      "interventionIds":[
        "intervention_VHI1"
      ]
    },
    {
      "ann:id":"voluntaryHomeIsolationContacts",
      "trigger":{
        "left":{
          "sizeof":{
            "set":{
              "idRef":"sourceNodeParticipateInHomeIsolation"
            }
          }
        },
        "operator":">",
        "right":{
          "value":{
            "number":0
          }
        }
      },
      "interventionIds":[
        "intervention_VHI2"
      ]
    }
  ],
  "interventions":[
    {
      "$comment":"select individuals compliant for SH",
      "id":"intervention_SH_select",
      "target":{
        "elementType":"node",
        "scope":"local"
      },
      "sampling":{
        "type":"individual",
        "number":91.8240887140855,
        "sampled":{
          "foreach":[
            {
              "delay":0,
              "operations":[
                {
                  "target":{
                    "node":{
                      "property":"nodeTrait",
                      "feature":"participateInStayHome"
                    }
                  },
                  "operator":"=",
                  "value":{
                    "trait":"nodeTrait",
                    "feature":"participateInStayHome",
                    "enum":"true"
                  }
                }
              ]
            },
            {
              "delay":1,
              "operations":[
                {
                  "target":{
                    "node":{
                      "property":"nodeTrait",
                      "feature":"participateInStayHome"
                    }
                  },
                  "operator":"=",
                  "value":{
                    "trait":"nodeTrait",
                    "feature":"participateInStayHome",
                    "enum":"false"
                  }
                }
              ]
            }
          ]
        }
      },
      "once":[
        {
          "operations":[
            {
              "target":{
                "variable":{
                  "idRef":"stayHome"
                }
              },
              "operator":"=",
              "value":{
                "number":1
              }
            }
          ]
        }
      ]
    },
    {
      "$comment":"Stay Home (self)",
      "id":"intervention_SH1",
      "target":{
        "set":{
          "idRef":"targetNodeParticipateInStayHome"
        }
      },
      "foreach":[
        {
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"/=",
              "value":{
                "number":1000000
              }
            }
          ]
        },
        {
          "delay":72,
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"*=",
              "value":{
                "number":1000000
              }
            }
          ]
        }
      ]
    },
    {
      "$comment":"Stay Home (contacts)",
      "id":"intervention_SH2",
      "target":{
        "set":{
          "idRef":"sourceNodeParticipateInStayHome"
        }
      },
      "foreach":[
        {
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"/=",
              "value":{
                "number":1000000
              }
            }
          ]
        },
        {
          "delay":72,
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"*=",
              "value":{
                "number":1000000
              }
            }
          ]
        }
      ]
    },
    {
      "$comment":"School Closure (students)",
      "id":"intervention_SC1",
      "target":{
        "elementType":"edge",
        "left":{
          "edge":{
            "property":"targetActivity",
            "feature":"activityType"
          }
        },
        "operator":"withPropertyIn",
        "right":{
          "valueList":{
            "trait":"activityTrait",
            "feature":"activityType",
            "enum":[
              "school",
              "college"
            ]
          }
        }
      },
      "foreach":[
        {
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"/=",
              "value":{
                "number":1000000
              }
            }
          ]
        },
        {
          "delay":168,
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"*=",
              "value":{
                "number":1000000
              }
            }
          ]
        }
      ],
      "once":[
        {
          "operations":[
            {
              "target":{
                "variable":{
                  "idRef":"schoolClosed"
                }
              },
              "operator":"=",
              "value":{
                "number":1
              }
            }
          ]
        }
      ]
    },
    {
      "$comment":"School Closure (teachers)",
      "id":"intervention_SC2",
      "target":{
        "elementType":"edge",
        "left":{
          "edge":{
            "property":"sourceActivity",
            "feature":"activityType"
          }
        },
        "operator":"withPropertyIn",
        "right":{
          "valueList":{
            "trait":"activityTrait",
            "feature":"activityType",
            "enum":[
              "school",
              "college"
            ]
          }
        }
      },
      "foreach":[
        {
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"/=",
              "value":{
                "number":1000000
              }
            }
          ]
        },
        {
          "delay":168,
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"*=",
              "value":{
                "number":1000000
              }
            }
          ]
        }
      ]
    },
    {
      "$comment":"Mark indiviudal as having entered previously",
      "trigger":{
        "left":{
          "sizeof":{
            "set":{
              "idRef":"triggerTemplate1_enteredIsymp"
            }
          }
        },
        "operator":">",
        "right":{
          "value":{
            "number":0
          }
        }
      },
      "target":{
        "set":{
          "idRef":"triggerTemplate1_enteredIsymp"
        }
      },
      "foreach":[
        {
          "operations":[
            {
              "target":{
                "node":{
                  "property":"nodeTrait",
                  "feature":"enteredIsymp"
                }
              },
              "operator":"=",
              "value":{
                "trait":"nodeTrait",
                "feature":"enteredIsymp",
                "enum":"true"
              }
            }
          ]
        }
      ]
    },
    {
      "$comment":"Select Participants for voluntary Home Isolation",
      "id":"intervention_VHI_select",
      "target":{
        "set":{
          "idRef":"triggerTemplate1_enteredIsymp"
        }
      },
      "sampling":{
        "type":"individual",
        "number":53.7228990690783,
        "sampled":{
          "foreach":[
            {
              "delay":0,
              "operations":[
                {
                  "target":{
                    "node":{
                      "property":"nodeTrait",
                      "feature":"participateInHomeIsolation"
                    }
                  },
                  "operator":"=",
                  "value":{
                    "trait":"nodeTrait",
                    "feature":"participateInHomeIsolation",
                    "enum":"true"
                  }
                }
              ]
            },
            {
              "delay":1,
              "operations":[
                {
                  "target":{
                    "node":{
                      "property":"nodeTrait",
                      "feature":"participateInHomeIsolation"
                    }
                  },
                  "operator":"=",
                  "value":{
                    "trait":"nodeTrait",
                    "feature":"participateInHomeIsolation",
                    "enum":"false"
                  }
                }
              ]
            }
          ]
        }
      }
    },
    {
      "$comment":"Voluntary Home Isolation (self)",
      "id":"intervention_VHI1",
      "target":{
        "set":{
          "idRef":"targetNodeParticipateInHomeIsolation"
        }
      },
      "foreach":[
        {
          "delay":1,
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"/=",
              "value":{
                "number":1000000
              }
            }
          ]
        },
        {
          "delay":15,
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"*=",
              "value":{
                "number":1000000
              }
            }
          ]
        }
      ]
    },
    {
      "$comment":"Voluntary Home Isolation (contacts)",
      "id":"intervention_VHI2",
      "target":{
        "set":{
          "idRef":"sourceNodeParticipateInHomeIsolation"
        }
      },
      "foreach":[
        {
          "delay":1,
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"/=",
              "value":{
                "number":1000000
              }
            }
          ]
        },
        {
          "delay":15,
          "operations":[
            {
              "target":{
                "edge":{
                  "property":"weight"
                }
              },
              "operator":"*=",
              "value":{
                "number":1000000
              }
            }
          ]
        }
      ]
    }
  ]
}
